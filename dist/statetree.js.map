{"version":3,"file":"statetree.js","sources":["webpack:///webpack/bootstrap 6397f061261a0f32fc2c","webpack:///external \"jQuery\"","webpack:///./src/index.js","webpack:///./src/tree.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6397f061261a0f32fc2c","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = 0","const $ = require( \"jquery\" );\n\nconst NAMESPACE = \"pkui.tree.state\";\n\nconst StateTree = require( \"./tree\" );\n\n$.fn.stateTree = function ( options ) {\n\n    if ( typeof options === \"string\" ) {\n        var\n            instance = this.data( NAMESPACE )\n        ;\n        return instance[ options ].apply( instance, Array.prototype.slice.call( arguments, 1 ) );\n    }\n\n    this.each( function () {\n        var\n            $this = $( this ),\n            instance = $this.data( NAMESPACE )\n        ;\n\n        // 如果没有初始化，则进行初始化\n        if ( ! instance ) {\n            instance = new StateTree( $this, options );\n            $this.data( NAMESPACE, instance );\n        }\n\n    } );\n\n    return this;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.js\n// module id = 1\n// module chunks = 0","const $ = require( \"jquery\" );\n\n/**\n * @description 默认参数\n */\nTree.prototype.defaults = {\n    \"core\": {\n        \"url\": \"./testJsTree_2.json\",\n        \"defaultFolderIcon\": \"fa fa-folder\",\n        \"defaultFileIcon\": \"fa fa-file\",\n        // { 1: true, 2: true }\n        \"rootId\": null\n    },\n    \"mapping\": {\n        \"id\": \"menuId\",\n        \"text\": \"menuName\",\n        \"icon\": \"icon\",\n        \"parentId\": \"treeParentid\",\n        \"visible\": \"visiable\",\n        \"expand\": \"expand\",\n        \"selected\": \"selected\"\n    }\n};\n\n/**\n * @param $target 菜单树目标\n * @param options {*?}\n * @constructor\n */\nfunction Tree( $target, options ) {\n    this.$target = $target;\n    this.options = $.extend( true, {}, this.defaults, options );\n    this.idMapping = {};\n    this._init();\n}\n\n\n/**\n * @description 缓存。缓存指定URL的数据\n * @type {{}}\n */\nTree.cache = {};\n\n/**\n * @description 初始化\n * @private\n */\nTree.prototype._init = function () {\n    var\n        _this = this,\n        options = this.options,\n        url = options.core.url\n    ;\n\n    // 已缓存\n    if ( Tree.cache[ url ] ) {\n        _this.createJsTree( Tree.cache[ url ] );\n        return;\n    }\n\n    // Ajax请求\n    $.ajax( {\n        url: url,\n        method: \"GET\",\n        cache: false\n    } ).done( function ( gridResult ) {\n        if ( !gridResult ||\n            gridResult.success === false ||\n            gridResult.data === null ||\n            gridResult.data === undefined ) {\n\n            alert( ( gridResult && gridResult.message ) || \"状态树构建失败！\" );\n            return;\n        }\n        Tree.cache[ url ] = gridResult;\n        _this.createJsTree( gridResult );\n    } ).fail( function ( ) {\n        console.error( \"【构建状态树】请求失败！\" );\n    } );\n\n\n};\n\n/**\n * @description 创建JsTree\n * @param gridResult {{data:*}}\n */\nTree.prototype.createJsTree = function ( gridResult ) {\n    var\n        _this = this,\n        options = this.options,\n        originData,\n        fmtData,\n        jstreeData,\n        jstreeOptions = {},\n        mapping = options.mapping\n    ;\n\n    originData = gridResult.data;\n\n    this.originData = originData;\n\n    fmtData = fmtListData.call( _this, originData );\n\n    jstreeData = getTreeList( {\n        data: fmtData,\n        rootId: options.core.rootId,\n        idName: mapping.id,\n        parentIdName: mapping.parentId,\n        childrenName: \"children\"\n    } );\n\n    jstreeOptions.core = {\n        \"data\" : jstreeData,\n        \"dblclick_toggle\": false,\n        \"check_callback\" : true\n    };\n\n    jstreeOptions.checkbox = {\n        keep_selected_style: false\n    };\n\n    jstreeOptions.plugins = [ /*\"wholerow\",*/ \"checkbox\" ];\n\n    _this.$target.jstree( jstreeOptions );\n\n    // 标志\n    _this.$target.addClass( \"jstree-statetree\" );\n};\n\n/**\n * @description 获取原始数据\n * @return {*}\n */\nTree.prototype.getData = function () {\n    return this.originData;\n};\n\n/**\n * @description 获取指定id的节点\n * @param idList {String|Array} 单个id字符串 或 多个id组成的数组\n * @return {Array}\n */\nTree.prototype.getNodeById = function ( idList ) {\n    var\n        ref = this.$target.jstree( true ),\n        node,\n        nodeList = [],\n        i, len, id\n    ;\n    if ( typeof idList === \"string\" ) {\n        idList = [ idList ];\n    }\n    for ( i = 0, len = idList.length; i < len; i++ ) {\n        id = this.idMapping[ idList[ i ] ];\n        node = ref.get_node( id );\n        nodeList.push( node );\n    }\n    return nodeList;\n};\n\n/**\n * @description 获取选中的节点\n * @return {Array}\n */\nTree.prototype.getSelectedNodes = function () {\n    var\n        ref = this.$target.jstree( true ),\n        selectedNodes = ref.get_selected( true )\n    ;\n    return selectedNodes;\n};\n\n/**\n * @description 选中指定id的节点\n * @param idList {String|Array} 单个id字符串 或 多个id组成的数组\n */\nTree.prototype.selectNodeById = function ( idList ) {\n    var\n        ref = this.$target.jstree( true ),\n        i, len,\n        idArray = []\n    ;\n    for ( i = 0, len = idList.length; i < len; i++ ) {\n        idArray.push( this.idMapping[ idList[ i ] ] );\n    }\n    ref.select_node( idArray );\n};\n\n/**\n * @description 反选指定id的节点\n * @param idList {String|Array} 单个id字符串 或 多个id组成的数组\n */\nTree.prototype.deselectNodeById = function ( idList ) {\n    var\n        ref = this.$target.jstree( true ),\n        i, len,\n        idArray = []\n    ;\n    for ( i = 0, len = idList.length; i < len; i++ ) {\n        idArray.push( this.idMapping[ idList[ i ] ] );\n    }\n    ref.deselect_node( idArray );\n};\n\n\n/**\n * @description 格式化 列表数据\n * @param list {Array}\n * @returns {Array}\n */\nfunction fmtListData( list ) {\n    var\n        parentIdSet = {},\n        fmtList = [],\n        options = this.options,\n        idMapping = this.idMapping,\n        mapping = options.mapping\n    ;\n\n    $.each( list, function ( index, item ) {\n        parentIdSet[ item[ mapping.parentId ] ] = true;\n    } );\n\n    // 添加 jstree 必须的属性\n    $.each( list, function ( index, item ) {\n        var\n            data,\n            id,\n            text,\n            icon\n        ;\n\n        if( ! getBoolean( item[ mapping.visible ] ) ) {\n            return;\n        }\n\n        // 绑定的 data\n        data = $.extend( true, {}, item );\n\n        // ID（HTML属性）\n        id = \"jstree_node_\"  + ( new Date() ).getTime() + \"_\" + item[ mapping.id ];\n\n        idMapping[ item[ mapping.id ] ] = id;\n\n        text = item[ mapping.text ];\n\n        icon = item[ mapping.icon ];\n\n        if ( ! icon ) {\n            icon = parentIdSet[ item[ mapping.id ] ] ?\n                options.core.defaultFolderIcon  :\n                options.core.defaultFileIcon\n            ;\n        }\n\n        fmtList.push( $.extend( true, {}, item, {\n            \"data\": data,\n            \"id\": id,\n            \"text\": text,\n            \"icon\": icon,\n            \"state\": {\n                \"opened\": getBoolean( item[ mapping.expand ] ),\n                \"selected\": getBoolean( item[ mapping.selected ] )\n            }\n        } ) );\n\n    } );\n\n    return fmtList;\n}\n\n/**\n * @description 根据参数获取树形数据\n * @param options\n * @return {*}\n */\nfunction getTreeList( options ) {\n    var\n        data = options.data,\n        rootId = options.rootId,\n        idName = options.idName || \"id\",\n        parentIdName = options.parentIdName || \"parentId\",\n        childrenName = options.childrenName || \"children\",\n        returnData,\n        childrenCollection = {},\n        parentId,\n        rootList = []\n    ;\n\n    // 如果没有指定根节点的ID，则将所有 treeParentId == null 的节点作为根节点\n    if ( rootId === null || rootId === undefined ) {\n        // rootId = data[ 0 ][ idName ];\n        $.each( data, function ( index, elt ) {\n            var parentId = elt[ parentIdName ];\n            if ( parentId === null\n                || parentId === undefined\n                || parentId === -1\n                || parentId === \"-1\") {\n                rootList.push( elt );\n            }\n        } );\n    }\n    else {\n        // 多个 rootId\n        if ( typeof rootId === \"object\" ) {\n            $.each( data, function ( index, elt ) {\n                var\n                    id = elt[ idName ]\n                ;\n                if ( rootId.hasOwnProperty( id ) ) {\n                    rootList.push( elt );\n                }\n            } );\n        }\n        // 单个\n        else {\n            $.each( data, function ( index, elt ) {\n                var\n                    id = elt[ idName ]\n                ;\n                if ( id === rootId ) {\n                    rootList.push( elt );\n                    return false;\n                }\n            } );\n        }\n    }\n\n\n    $.each( data, function ( index, elt ) {\n        if ( elt === null || elt === undefined ) {\n            return;\n        }\n        parentId = elt[ parentIdName ];\n        childrenCollection[ parentId ] = childrenCollection[ parentId ] || [];\n        childrenCollection[ parentId ].push( elt );\n    } );\n\n    returnData = fmtData( rootList );\n\n    function fmtData( data ) {\n        var list = []\n        ;\n        if ( !data || !data.length ) {\n            return null;\n        }\n        $.each( data, function ( index, elt ) {\n            var record = elt,\n                newRecord\n            ;\n            newRecord = $.extend( true, {}, record );\n            newRecord[ childrenName ] = fmtData( childrenCollection[ record[ idName ] ] );\n            list.push( newRecord );\n        } );\n        return list;\n    }\n\n\n    return returnData;\n\n}\n\n/**\n * @description 获取布尔值\n * @param value\n * @return {boolean}\n */\nfunction getBoolean ( value ) {\n    var\n        booleanValue = true\n    ;\n\n    if ( value === 0 ||\n        value === \"0\" ||\n        value === false ||\n        value === null ||\n        value === undefined\n    ) {\n        booleanValue = false;\n    }\n\n    return booleanValue;\n}\n\n\nmodule.exports = Tree;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/tree.js\n// module id = 2\n// module chunks = 0"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC7DA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A","sourceRoot":""}